<!DOCTYPE HTML>
<html lang="en" >
    <head>
<meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>Socket傳送檔案 </title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="Cici's notebook."><meta name="generator" content="Jekyll (using style of GitBook)"><meta name="keywords" content="c++, socket send file"><link rel="stylesheet" href="/assets/gitbook/style.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-expandable-chapters-small2/expandable-chapters-small.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-fontsettings/website.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-search-pro/search.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-splitter/splitter.css">

<link rel="stylesheet" href="/assets/gitbook/rouge/base16.css">

<link rel="stylesheet" href="/assets/gitbook/custom.css">
<link rel="stylesheet" href="/assets/gitbook/custom-local.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="/" type="image/x-icon">

<link rel="stylesheet" href="/assets/custom_css/code.css">

</head>
    <body>
        <div class="book">
            
            <div class="book-summary">
    <script type="text/javascript">
        // Fixes the page links scroll problem on both desktop and mobile browsers
        function pageScrollToTop(element) {
            // both mobile and non-mobile
            $('div.body-inner').animate({scrollTop: 0});
            $(element).parent().find('li>ul>li').removeClass('active');
            return true;  // propagate
        }
        // Fixes the anchor links scroll problem on mobile browsers
        function mobilePageScrollToAnchor(element) {
            $(element).closest('li.chapter').find('ul>li').removeClass('active');
            $(element).parent().addClass('active');
            if ($(document).width() <= 1240) {
                $('div.body-inner').animate({scrollTop: $($(element).attr('href')).get(0).offsetTop});
            }
            return true;
        }
    </script>

    <nav role="navigation">
        <div id="book-search-input" role="search">
            <input type="text" placeholder="Type to search" />
        </div>
        <div id="book-search-input-link" role="search">
            <a href="/assets/search.html">Click to Search</a>
        </div>
        <ul class="summary">
            
            <li class="chapter" data-level="1.1" data-path="">
            
                <a href="/" onclick="pageScrollToTop(this)">
                    Cici&#39;s notebook
                </a>
            </li>
            <li class="divider"></li>
            
            
	
	
	<li class="chapter" data-level="1.1" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> C++ </a><ul>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 寫C++在MAC </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/editor/xcode" onclick="pageScrollToTop(this)"> Xcode</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/editor/vscode" onclick="pageScrollToTop(this)"> VS on Mac</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/editor/clang" onclick="pageScrollToTop(this)"> 安裝VS在MAC(實作)</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/editor/vsDebug" onclick="pageScrollToTop(this)"> VS Debug</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/editor/cmake" onclick="pageScrollToTop(this)"> Cmake on Mac</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/editor/supportc11" onclick="pageScrollToTop(this)"> Xcode支援C++11以上</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/editor/rvo" onclick="pageScrollToTop(this)"> 關閉RVO</a>
        
            
        </li></ul></li>
	
	
	<li class="">
    	<a href="/pages/c/basic/simpleTraditionC" onclick="pageScrollToTop(this)"> 台陸指標相關名詞差異</a>
        
            
        </li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 基本知識 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/basic/format" onclick="pageScrollToTop(this)"> 程式碼格式</a>
        
            
        </li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 資料型態 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/basic/typicalRange" onclick="pageScrollToTop(this)"> 資料型態範圍</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/basic/charType" onclick="pageScrollToTop(this)"> char字元</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/basic/boolType" onclick="pageScrollToTop(this)"> bool</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/basic/printformat" onclick="pageScrollToTop(this)"> 整數與浮點數</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/basic/typedef" onclick="pageScrollToTop(this)"> typedef類型別名</a>
        
            
        </li></ul></li>
	
	
	<li class="">
    	<a href="/pages/c/basic/param" onclick="pageScrollToTop(this)"> 參數與引數</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/basic/scope" onclick="pageScrollToTop(this)"> 變數可見範圍與生命週期</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/basic/loop" onclick="pageScrollToTop(this)"> 迴圈</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/basic/rand" onclick="pageScrollToTop(this)"> 亂數</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/basic/main" onclick="pageScrollToTop(this)"> main</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/basic/include" onclick="pageScrollToTop(this)"> include與define</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/basic/linux_shell" onclick="pageScrollToTop(this)"> Linux shell指令</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 編譯 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/editor/openssh_server" onclick="pageScrollToTop(this)"> 安裝openssh-server</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/compile/makefile" onclick="pageScrollToTop(this)"> makefile</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/compile/gdb" onclick="pageScrollToTop(this)"> gdb</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/compile/core_dump" onclick="pageScrollToTop(this)"> gdb core dump</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/compile/gdb_attach_pid" onclick="pageScrollToTop(this)"> gdb attach pid</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 指標 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/pointer/pointer" onclick="pageScrollToTop(this)"> 指標基本觀念</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/pointer/pointerConst" onclick="pageScrollToTop(this)"> const與指標</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/pointer/pointerVoid" onclick="pageScrollToTop(this)"> void*任何資料型態的指標</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/pointer/nullptr" onclick="pageScrollToTop(this)"> 0 == nullptr == NULL</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/pointer/wildPointer" onclick="pageScrollToTop(this)"> 指標位址是無效內容</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/pointer/pointerToPointer" onclick="pageScrollToTop(this)"> 指標的指標</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/pointer/pointerArithmetic" onclick="pageScrollToTop(this)"> 指標運算</a>
        
            
        </li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 指向陣列的指標 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/array/array" onclick="pageScrollToTop(this)"> 陣列</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/array/pointerToArray" onclick="pageScrollToTop(this)"> 一維陣列與指標</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/array/dynamicArrays" onclick="pageScrollToTop(this)"> 陣列與動態配置記憶體</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/array/qsort" onclick="pageScrollToTop(this)"> qsort排序</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/array/array2dimen" onclick="pageScrollToTop(this)"> 二維陣列</a>
        
            
        </li></ul></li>
	
	
	<li class="">
    	<a href="/pages/c/array/arrayOfPointers" onclick="pageScrollToTop(this)"> 指標陣列存放多個記憶體位址</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 字串 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/array/charArray" onclick="pageScrollToTop(this)"> char 字串</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/array/pointerCharArr" onclick="pageScrollToTop(this)"> char字串指標</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/string/string_convert" onclick="pageScrollToTop(this)"> string convert</a>
        
            
        </li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 實作字串函式 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/basic/strLen" onclick="pageScrollToTop(this)"> 取得字串長度</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/string/reverseStr" onclick="pageScrollToTop(this)"> 原地反轉字串</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/string/integerToStr" onclick="pageScrollToTop(this)"> 整數轉成字串</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/string/stringToInt" onclick="pageScrollToTop(this)"> 字串轉成數字</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/string/stringCopy" onclick="pageScrollToTop(this)"> 字串拷貝</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/string/stringCat" onclick="pageScrollToTop(this)"> 字串連結</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/string/strchr" onclick="pageScrollToTop(this)"> 字元搜尋</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/string/strcmp" onclick="pageScrollToTop(this)"> 字串比較</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/string/strstr" onclick="pageScrollToTop(this)"> 字串搜尋</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/string/delstr" onclick="pageScrollToTop(this)"> 刪除字元</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/string/split" onclick="pageScrollToTop(this)"> split 切割字串</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/string/xml" onclick="pageScrollToTop(this)"> xml搜尋</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/string/chineseAscii" onclick="pageScrollToTop(this)"> ASCII與中文</a>
        
            
        </li></ul></li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 參考 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/reference/reference" onclick="pageScrollToTop(this)"> 參考</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/reference/refToPointer" onclick="pageScrollToTop(this)"> 參考指向指標</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/reference/l_ref_func" onclick="pageScrollToTop(this)"> 等號左邊的函式</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 函式 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/function/func_def" onclick="pageScrollToTop(this)"> 函式宣告與定義</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/function/callByValue" onclick="pageScrollToTop(this)"> 函式傳值與傳回值</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/function/func_param_pointer" onclick="pageScrollToTop(this)"> 函式參數為指標</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/function/callByRef" onclick="pageScrollToTop(this)"> 函式傳參考</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/function/func_return_ref" onclick="pageScrollToTop(this)"> 函式傳回值是參考</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/function/func_overload" onclick="pageScrollToTop(this)"> 函式多載</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/function/func_inline" onclick="pageScrollToTop(this)"> 內嵌函式</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/function/func_default_param" onclick="pageScrollToTop(this)"> 函式參數預設值</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/function/functionPointer" onclick="pageScrollToTop(this)"> 函式指標</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/function/func_ref" onclick="pageScrollToTop(this)"> 函式參考</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/function/auto_func" onclick="pageScrollToTop(this)"> auto與函式</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/function/lambda" onclick="pageScrollToTop(this)"> lambda</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/function/using_func_pointer" onclick="pageScrollToTop(this)"> using函式指標別名</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 記憶體 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/dynamicMemory/memoryLayout" onclick="pageScrollToTop(this)"> 記憶體配置</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dynamicMemory/newDelete" onclick="pageScrollToTop(this)"> new/delete</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dynamicMemory/nothrow" onclick="pageScrollToTop(this)"> 記憶體不足</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dynamicMemory/memset" onclick="pageScrollToTop(this)"> memset</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dynamicMemory/memory_interval" onclick="pageScrollToTop(this)"> 記憶體間隔計算</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 結構 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/struct/struct_def" onclick="pageScrollToTop(this)"> 定義結構</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/struct/struct_char" onclick="pageScrollToTop(this)"> 結構與字串</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/struct/struct_init" onclick="pageScrollToTop(this)"> 初始化結構</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/struct/struct_array" onclick="pageScrollToTop(this)"> 結構陣列</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/struct/struct_pointer" onclick="pageScrollToTop(this)"> 指標指向結構</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/struct/nestedStruct" onclick="pageScrollToTop(this)"> 巢狀結構</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/struct/arrayInStruct" onclick="pageScrollToTop(this)"> 結構中的陣列</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/struct/pointerInStruct" onclick="pageScrollToTop(this)"> 結構中的指標</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/struct/linked_list" onclick="pageScrollToTop(this)"> 鏈結串列</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 資料結構與演算法 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/dataStruct/arrayList" onclick="pageScrollToTop(this)"> ArrayList實作</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dataStruct/arrayListExtCap" onclick="pageScrollToTop(this)"> ArrayList擴展容量</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dataStruct/linkedList" onclick="pageScrollToTop(this)"> 單向鏈結串列實作</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dataStruct/doublelinkedList" onclick="pageScrollToTop(this)"> 雙向鏈結串列實作</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dataStruct/stack" onclick="pageScrollToTop(this)"> Stack實作</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dataStruct/queue" onclick="pageScrollToTop(this)"> Queue實作</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dataStruct/circular_queue" onclick="pageScrollToTop(this)"> circular queue環狀佇列</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dataStruct/bubbleSort" onclick="pageScrollToTop(this)"> 氣泡排序</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dataStruct/insertSort" onclick="pageScrollToTop(this)"> 插入排序</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dataStruct/quickSort" onclick="pageScrollToTop(this)"> 快速排序</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dataStruct/mergeSort" onclick="pageScrollToTop(this)"> 合併排序</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/dataStruct/recursion" onclick="pageScrollToTop(this)"> 遞迴</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 類別與物件 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/class/class" onclick="pageScrollToTop(this)"> 類別與物件</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/class/enum" onclick="pageScrollToTop(this)"> Enum列舉</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/class/constructor" onclick="pageScrollToTop(this)"> 建構子與解構子</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/class/anonymous_obj" onclick="pageScrollToTop(this)"> 匿名物件</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/class/temp_obj" onclick="pageScrollToTop(this)"> 臨時物件temporary object</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/class/init_list" onclick="pageScrollToTop(this)"> 建構子初始化列表</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/class/member_class" onclick="pageScrollToTop(this)"> 成員變數是類別</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/class/static_class" onclick="pageScrollToTop(this)"> 靜態類別變數與函式</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/class/copy_constructor" onclick="pageScrollToTop(this)"> 拷貝函式</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/class/deep_shallow_copy" onclick="pageScrollToTop(this)"> 深淺拷貝</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/class/operator_assign" onclick="pageScrollToTop(this)"> operator=()</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/class/functor" onclick="pageScrollToTop(this)"> operator()物件函式</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/class/operator_add" onclick="pageScrollToTop(this)"> operator+()</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/class/operator_equal" onclick="pageScrollToTop(this)"> operator==()</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/class/inheritance" onclick="pageScrollToTop(this)"> 繼承</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 轉型 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/conversion/implicit" onclick="pageScrollToTop(this)"> 自動轉型</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/conversion/explicit" onclick="pageScrollToTop(this)"> 強制轉型</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/conversion/conversion_function" onclick="pageScrollToTop(this)"> 建構子轉型</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/conversion/type_conversion" onclick="pageScrollToTop(this)"> c++型別轉換</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/conversion/cast_operator" onclick="pageScrollToTop(this)"> cast operator型別轉換運算子</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 模板 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/template/function_template" onclick="pageScrollToTop(this)"> 函式模板</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/template/function_class_template" onclick="pageScrollToTop(this)"> 類別中函式模板</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/template/special_template" onclick="pageScrollToTop(this)"> 模板特製化</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/template/class_template" onclick="pageScrollToTop(this)"> 類別模板</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/template/stack_template" onclick="pageScrollToTop(this)"> Stack實作(int Array)</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/template/foreach_template" onclick="pageScrollToTop(this)"> foreach模板</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/template/findif_template" onclick="pageScrollToTop(this)"> find_if模板</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/template/bsort_template" onclick="pageScrollToTop(this)"> 氣泡排序模板</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> STL Containers </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/stl/string" onclick="pageScrollToTop(this)"> string</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/stl/iterator" onclick="pageScrollToTop(this)"> iterator疊代器</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/stl/pair" onclick="pageScrollToTop(this)"> pair</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/stl/map" onclick="pageScrollToTop(this)"> map</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> c11 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/c11/init_list" onclick="pageScrollToTop(this)"> 初始化initializer list</a>
        
            
        </li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> 左值與右值 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/c11/rvalue/l_r_value" onclick="pageScrollToTop(this)"> l-value與r-value</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/c11/rvalue/l_r_ref" onclick="pageScrollToTop(this)"> l-value參考與r-value參考</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/c11/rvalue/constRef" onclick="pageScrollToTop(this)"> const與參考</a>
        
            
        </li></ul></li>
	
	
	<li class="">
    	<a href="/pages/c/c11/move_operator" onclick="pageScrollToTop(this)"> 移動建構子與移動指派運算子</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/c11/forward" onclick="pageScrollToTop(this)"> forward</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/c11/functional" onclick="pageScrollToTop(this)"> functional</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/c11/bind" onclick="pageScrollToTop(this)"> bind綁定</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/c11/variadic" onclick="pageScrollToTop(this)"> 可變參數模板</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/c11/callback" onclick="pageScrollToTop(this)"> callback</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> pthread </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/pthread/create_pthread" onclick="pageScrollToTop(this)"> 建立pthread</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> Thread(C11) </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/thread/create_thread" onclick="pageScrollToTop(this)"> 建立thread</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/thread/join" onclick="pageScrollToTop(this)"> 執行緒記憶體釋放</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/thread/this_thread" onclick="pageScrollToTop(this)"> this_thread</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/thread/mutex" onclick="pageScrollToTop(this)"> 互斥鎖Mutex</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/thread/condition_variable" onclick="pageScrollToTop(this)"> condition_variable</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> time </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/time/chrono" onclick="pageScrollToTop(this)"> 程式執行時間</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/time/time" onclick="pageScrollToTop(this)"> time</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> file </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/file/file_io" onclick="pageScrollToTop(this)"> File IO</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/file/file_desc" onclick="pageScrollToTop(this)"> File description</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> linux系統c函式庫 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/libc/errno" onclick="pageScrollToTop(this)"> 取得錯誤訊息</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/libc/file_io" onclick="pageScrollToTop(this)"> 檔案目錄操作</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/libc/system_execl" onclick="pageScrollToTop(this)"> system與execl</a>
        
            
        </li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> process相關 </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/libc/signal" onclick="pageScrollToTop(this)"> signal訊號</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/libc/exit" onclick="pageScrollToTop(this)"> exit終止程序</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/libc/fork" onclick="pageScrollToTop(this)"> fork 複製程序</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/libc/kill" onclick="pageScrollToTop(this)"> kill</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/libc/shared_memory" onclick="pageScrollToTop(this)"> Shared Memory共用記憶體</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/libc/semaphore" onclick="pageScrollToTop(this)"> semaphore</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/libc/semaph_que" onclick="pageScrollToTop(this)"> semaphore作為condition</a>
        
            
        </li></ul></li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> socket </a><ul>
	
	
	<li class="">
    	<a href="/pages/c/socket/socket" onclick="pageScrollToTop(this)"> socket</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/c/socket/fork_socket" onclick="pageScrollToTop(this)"> 多工的socket</a>
        
            
        </li>
	
	
	<li class="active">
    	<a href="/pages/c/socket/file_socket" onclick="pageScrollToTop(this)"> Socket傳送檔案</a>
        
            
                <ul><li><a href="#client" onclick="mobilePageScrollToAnchor(this)" >client</a><ul><li><a href="#傳送流程" onclick="mobilePageScrollToAnchor(this)" >傳送流程</a></li><li><a href="#傳送檔名與檔案大小" onclick="mobilePageScrollToAnchor(this)" >傳送檔名與檔案大小</a></li><li><a href="#傳送檔案" onclick="mobilePageScrollToAnchor(this)" >傳送檔案</a></li><li><a href="#main參數" onclick="mobilePageScrollToAnchor(this)" >main參數</a></li><li><a href="#檔案結構" onclick="mobilePageScrollToAnchor(this)" >檔案結構</a></li><li><a href="#傳送檔名與檔案大小-1" onclick="mobilePageScrollToAnchor(this)" >傳送檔名與檔案大小</a></li><li><a href="#傳送完檔名與檔案後取得server回應" onclick="mobilePageScrollToAnchor(this)" >傳送完檔名與檔案後，取得server回應</a></li><li><a href="#呼叫傳送檔案" onclick="mobilePageScrollToAnchor(this)" >呼叫傳送檔案</a></li><li><a href="#傳送檔案後取得server回應" onclick="mobilePageScrollToAnchor(this)" >傳送檔案後，取得server回應</a></li></ul></li><li><a href="#server" onclick="mobilePageScrollToAnchor(this)" >server</a><ul><li><a href="#接收檔案流程" onclick="mobilePageScrollToAnchor(this)" >接收檔案流程</a></li><li><a href="#接收檔名與大小" onclick="mobilePageScrollToAnchor(this)" >接收檔名與大小</a></li><li><a href="#接收檔案" onclick="mobilePageScrollToAnchor(this)" >接收檔案</a></li><li><a href="#main參數-1" onclick="mobilePageScrollToAnchor(this)" >main參數</a></li><li><a href="#檔案結構-1" onclick="mobilePageScrollToAnchor(this)" >檔案結構</a></li><li><a href="#接收檔名與大小-1" onclick="mobilePageScrollToAnchor(this)" >接收檔名與大小</a></li><li><a href="#回應client已收到檔名與大小" onclick="mobilePageScrollToAnchor(this)" >回應client已收到檔名與大小</a></li><li><a href="#接收檔案-1" onclick="mobilePageScrollToAnchor(this)" >接收檔案</a></li><li><a href="#回應client已收到檔案" onclick="mobilePageScrollToAnchor(this)" >回應client已收到檔案</a></li></ul></li><li><a href="#完整程式碼" onclick="mobilePageScrollToAnchor(this)" >完整程式碼</a><ul><li><a href="#client程式碼" onclick="mobilePageScrollToAnchor(this)" >client程式碼</a></li><li><a href="#server程式碼" onclick="mobilePageScrollToAnchor(this)" >server程式碼</a></li><li><a href="#測試方式" onclick="mobilePageScrollToAnchor(this)" >測試方式</a><ul><li><a href="#server-1" onclick="mobilePageScrollToAnchor(this)" >server</a></li><li><a href="#client-1" onclick="mobilePageScrollToAnchor(this)" >client</a></li></ul></li></ul></li></ul>

            
        </li></ul></li></ul></li>
	
	
	<li class="chapter" data-level="1.1" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> ffmpeg </a><ul>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> xcode </a><ul>
	
	
	<li class="">
    	<a href="/pages/ffmpeg/install_ffmpeg_mac" onclick="pageScrollToTop(this)"> FFmpeg on Mac</a>
        
            
        </li></ul></li>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> android </a><ul>
	
	
	<li class="">
    	<a href="/pages/ffmpeg/ndk" onclick="pageScrollToTop(this)"> NDK</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/ffmpeg/jni" onclick="pageScrollToTop(this)"> JNI</a>
        
            
        </li>
	
	
	<li class="">
    	<a href="/pages/ffmpeg/cmake" onclick="pageScrollToTop(this)"> cmake</a>
        
            
        </li></ul></li></ul></li>
	
	
	<li class="chapter" data-level="1.1" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> Jekyll </a><ul>
	
	
	<li class="chapter" data-level="1.2" data-path="http://localhost:4000"><a href="" onclick="pageScrollToTop(this)"> Install </a><ul>
	
	
	<li class="">
    	<a href="/pages/jekyll/install/how_to_install_ruby" onclick="pageScrollToTop(this)"> 安裝 Ruby on Mac</a>
        
            
        </li></ul></li></ul></li></ul>
    </nav>
</div>
            <div class="book-body">
                <div class="book-header" role="navigation">
                    <!-- Title -->
                    <h1>
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                        
                            <a href="." >Socket傳送檔案</a>
                        
                    </h1>
                </div>

                <div class="body-inner"><div class="page-wrapper" tabindex="-1" role="main">
    

    <div class="page-inner">
        <div id="book-search-results">
            <div class="search-noresults">
                <section class="normal markdown-section">
                    
                        <h1 id="/pages/c/socket/file_socket">Socket傳送檔案</h1>
                    

                    <p>Prerequisites:</p>
<ul>
  <li><a href="/pages/c/file/file_io/">File IO</a></li>
</ul>

<h2 id="client">client</h2>

<h3 id="傳送流程">傳送流程</h3>

<p>傳送檔名與大小 -&gt; 取得server回應(確認server已收到檔名與大小) -&gt; 傳送檔案 -&gt; 取得server回應(確認server已收到檔案)</p>

<h3 id="傳送檔名與檔案大小">傳送檔名與檔案大小</h3>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>  <span class="c1">// 傳送檔名與大小</span>
  <span class="kt">bool</span> <span class="nf">send</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// client_fd若已斷線，直接返回</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">client_fd_</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="c1">// send()第2個參數填記憶體位址，第3個參數填大小</span>
    <span class="k">if</span> <span class="p">((</span><span class="o">::</span><span class="n">send</span><span class="p">(</span><span class="n">client_fd_</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="傳送檔案">傳送檔案</h3>
<p>使用while無限迴圈，待檔案傳送完，就會離開無限迴圈。</p>

<p>把每個byte都視為1個磚頭，有1000個磚頭，每次只搬7個磚頭，直至1000個磚頭搬送完畢。</p>

<p>檔案每次只傳7byte，除非剩下要傳的byte小於7byte，才用小於7byte的數字傳送。</p>

<p>了解原理後，可以把7byte改成1024byte，每次只傳1024byte，直到全部的byte都傳送完畢。</p>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="code"><pre>  <span class="c1">// 傳送檔案</span>
  <span class="kt">bool</span> <span class="nf">sendFile</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">file_name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">file_size</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 參數2指定binaryfile</span>
    <span class="n">ifstream</span> <span class="n">fin</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fin</span><span class="p">.</span><span class="n">is_open</span><span class="p">()</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"open file ("</span> <span class="o">&lt;&lt;</span> <span class="n">file_name</span> <span class="o">&lt;&lt;</span> <span class="s">") fail"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 每次要讀資料的個數(byte)</span>
    <span class="kt">int</span> <span class="n">read</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// 記錄已傳送資料的個數，若total_byte == file_size代表傳送完</span>
    <span class="kt">int</span> <span class="n">total_bytes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// 每次只傳送7byte</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 清空</span>
      <span class="n">memset</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
      <span class="c1">// 如果剩下的byte數量，大於7個，就傳送7個</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">file_size</span> <span class="o">-</span> <span class="n">total_bytes</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">read</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="c1">//小於7，就傳小於7的數量</span>
        <span class="n">read</span> <span class="o">=</span> <span class="n">file_size</span> <span class="o">-</span> <span class="n">total_bytes</span><span class="p">;</span>
      <span class="n">fin</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">read</span><span class="p">);</span>
      <span class="c1">// 把讀到的資料送給server</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">send</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">read</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
      <span class="c1">// 加上已傳送的數量</span>
      <span class="n">total_bytes</span> <span class="o">+=</span> <span class="n">read</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">total_bytes</span> <span class="o">==</span> <span class="n">file_size</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="main參數">main參數</h3>
<p>改為傳送5個參數，<code class="language-plaintext highlighter-rouge">./client_test ip port 檔名 檔案大小</code></p>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre>  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"請輸入 ./client_test ip port 檔名 檔案大小"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="檔案結構">檔案結構</h3>

<p>包含檔名與檔案大小</p>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>  <span class="c1">// 檔案結構</span>
  <span class="k">struct</span> <span class="nc">FileInfo</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">filename</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>  <span class="c1">// 檔名</span>
    <span class="kt">int</span> <span class="n">filesize</span><span class="p">;</span>  <span class="c1">// 檔案大小</span>
  <span class="p">}</span> <span class="n">file_info</span><span class="p">;</span>  <span class="c1">// 變數名</span>
  <span class="c1">// 清空</span>
  <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">file_info</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">file_info</span><span class="p">));</span>
  <span class="n">strcpy</span><span class="p">(</span><span class="n">file_info</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>  <span class="c1">// 檔名</span>
  <span class="n">file_info</span><span class="p">.</span><span class="n">filesize</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>  <span class="c1">// 檔案大小  </span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="傳送檔名與檔案大小-1">傳送檔名與檔案大小</h3>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre>  <span class="c1">// 傳送檔名與檔案大小</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tcp_client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="o">&amp;</span><span class="n">file_info</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">file_info</span><span class="p">))</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"send"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="傳送完檔名與檔案後取得server回應">傳送完檔名與檔案後，取得server回應</h3>

<p>傳送完檔名與檔案大小，要等待server回應”ok”，代表server收到檔名與大小。</p>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre>  <span class="c1">// 收到server回應</span>
  <span class="n">string</span> <span class="n">buffer</span><span class="p">;</span>
  <span class="c1">// 參數2，"ok"是2byte</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tcp_client</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"recv"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">buffer</span> <span class="o">!=</span> <span class="s">"ok"</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"server沒回應ok"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="呼叫傳送檔案">呼叫傳送檔案</h3>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre>  <span class="c1">// 傳送檔案</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tcp_client</span><span class="p">.</span><span class="n">sendFile</span><span class="p">(</span><span class="n">file_info</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">file_info</span><span class="p">.</span><span class="n">filesize</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"sendFile"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="傳送檔案後取得server回應">傳送檔案後，取得server回應</h3>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre>  <span class="c1">// 參數2，"ok"是2byte</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tcp_client</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"recv"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">buffer</span> <span class="o">!=</span> <span class="s">"ok"</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"傳送檔案失敗"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"client 傳送檔案成功"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h2 id="server">server</h2>

<h3 id="接收檔案流程">接收檔案流程</h3>

<p>收到檔名與大小 -&gt; 回應client收到檔名與大小 -&gt; 收到檔案 -&gt; 回應client收到檔案</p>

<h3 id="接收檔名與大小">接收檔名與大小</h3>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre>  <span class="c1">// 收到client傳來的檔案結構</span>
  <span class="kt">bool</span> <span class="nf">recv</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">buffer</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">::</span><span class="n">recv</span><span class="p">(</span><span class="n">client_fd_</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="接收檔案">接收檔案</h3>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre>  
  <span class="kt">bool</span> <span class="nf">recvFile</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">file_name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">file_size</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ofstream</span> <span class="n">fout</span><span class="p">;</span>
    <span class="n">fout</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fout</span><span class="p">.</span><span class="n">is_open</span><span class="p">()</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"open file "</span> <span class="o">&lt;&lt;</span> <span class="n">file_name</span> <span class="o">&lt;&lt;</span> <span class="s">"fail"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">total_bytes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">read</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">file_size</span> <span class="o">-</span> <span class="n">total_bytes</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">read</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">read</span> <span class="o">=</span> <span class="n">file_size</span> <span class="o">-</span> <span class="n">total_bytes</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">recv</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">read</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
      <span class="n">fout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">read</span><span class="p">);</span>
      <span class="n">total_bytes</span> <span class="o">+=</span> <span class="n">read</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">total_bytes</span> <span class="o">==</span> <span class="n">file_size</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="main參數-1">main參數</h3>

<p>改為傳送3個參數，<code class="language-plaintext highlighter-rouge">./server_test port 存放目錄</code></p>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre>  
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"請輸入 ./server_test port 存放目錄"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="檔案結構-1">檔案結構</h3>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>  
  <span class="c1">// 檔案結構</span>
  <span class="k">struct</span> <span class="nc">FileInfo</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">filename</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>  <span class="c1">// 檔名</span>
    <span class="kt">int</span> <span class="n">filesize</span><span class="p">;</span>  <span class="c1">// 檔案大小</span>
  <span class="p">}</span> <span class="n">file_info</span><span class="p">;</span>  <span class="c1">// 變數名</span>
  <span class="c1">// 清空</span>
  <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">file_info</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">file_info</span><span class="p">));</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="接收檔名與大小-1">接收檔名與大小</h3>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre>  
  <span class="k">if</span> <span class="p">(</span><span class="n">tcpServer</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="o">&amp;</span><span class="n">file_info</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">file_info</span><span class="p">))</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"recv()"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"server 收到檔名 = "</span> <span class="o">&lt;&lt;</span> <span class="n">file_info</span><span class="p">.</span><span class="n">filename</span> <span class="o">&lt;&lt;</span>
  <span class="s">", 檔案大小 = "</span> <span class="o">&lt;&lt;</span> <span class="n">file_info</span><span class="p">.</span><span class="n">filesize</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="回應client已收到檔名與大小">回應client已收到檔名與大小</h3>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre> 
  <span class="k">if</span> <span class="p">(</span><span class="n">tcpServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"ok"</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"send"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="接收檔案-1">接收檔案</h3>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre>  <span class="k">if</span> <span class="p">(</span><span class="n">tcpServer</span><span class="p">.</span><span class="n">recvFile</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">file_info</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">file_info</span><span class="p">.</span><span class="n">filesize</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"檔案傳送失敗"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"檔案傳送成功"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="回應client已收到檔案">回應client已收到檔案</h3>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="n">tcpServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"ok"</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h2 id="完整程式碼">完整程式碼</h2>

<h3 id="client程式碼">client程式碼</h3>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
</pre></td><td class="code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;netdb.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;arpa/inet.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp">
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">TCPClient</span> <span class="p">{</span>
 <span class="nl">public:</span>
  <span class="c1">// 建構子，初始化client_fd，-1代表沒有連線</span>
  <span class="n">TCPClient</span><span class="p">()</span> <span class="o">:</span> <span class="n">client_fd_</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">bool</span> <span class="n">connect</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">ip</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// client_fd若已連線，就不用再連，直接返回</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">client_fd_</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">ip_</span> <span class="o">=</span> <span class="n">ip</span><span class="p">;</span>
    <span class="n">port_</span> <span class="o">=</span> <span class="n">port</span><span class="p">;</span>
    <span class="n">client_fd_</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="n">IPPROTO_TCP</span><span class="p">);</span>
    <span class="c1">// socket失敗傳回-1</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">client_fd_</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="c1">// server ip轉big-endian</span>
    <span class="k">struct</span> <span class="nc">hostent</span><span class="o">*</span> <span class="n">h</span><span class="p">;</span>
    <span class="c1">// gethostbyname需要cstring，所以要把string轉成cstring</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">h</span> <span class="o">=</span> <span class="n">gethostbyname</span><span class="p">(</span><span class="n">ip_</span><span class="p">.</span><span class="n">c_str</span><span class="p">()))</span> <span class="o">==</span> <span class="nb">nullptr</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"gethostbyname() fail."</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="c1">// 關閉socket</span>
      <span class="o">::</span><span class="n">close</span><span class="p">(</span><span class="n">client_fd_</span><span class="p">);</span>
      <span class="c1">// 失敗把client_fd還原成初始化-1</span>
      <span class="n">client_fd_</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// sockaddr_in結構</span>
    <span class="k">struct</span> <span class="nc">sockaddr_in</span> <span class="n">server_addr</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">server_addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">server_addr</span><span class="p">));</span>
    <span class="n">server_addr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
    <span class="c1">// server ip</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">server_addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">,</span> <span class="n">h</span><span class="o">-&gt;</span><span class="n">h_addr</span><span class="p">,</span> <span class="n">h</span><span class="o">-&gt;</span><span class="n">h_length</span><span class="p">);</span>
    <span class="c1">// server port</span>
    <span class="n">server_addr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">port_</span><span class="p">);</span>
    <span class="c1">// connect伺服器，傳回值為0代表連線成功，不是0代表連線失敗</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">::</span><span class="n">connect</span><span class="p">(</span><span class="n">client_fd_</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="nc">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">server_addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">server_addr</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 關閉socket</span>
      <span class="o">::</span><span class="n">close</span><span class="p">(</span><span class="n">client_fd_</span><span class="p">);</span>
      <span class="c1">// 失敗把client_fd還原成初始化-1</span>
      <span class="n">client_fd_</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 參數使用const string是因為既可支援string，也可支援const char*</span>
  <span class="kt">bool</span> <span class="n">send</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">buffer</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// client_fd若已斷線，直接返回</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">client_fd_</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="c1">// send()第2個參數填記憶體位址，第3個參數填大小</span>
    <span class="k">if</span> <span class="p">((</span><span class="o">::</span><span class="n">send</span><span class="p">(</span><span class="n">client_fd_</span><span class="p">,</span> <span class="n">buffer</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">buffer</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 傳送檔名與大小</span>
  <span class="kt">bool</span> <span class="n">send</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// client_fd若已斷線，直接返回</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">client_fd_</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="c1">// send()第2個參數填記憶體位址，第3個參數填大小</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">::</span><span class="n">send</span><span class="p">(</span><span class="n">client_fd_</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 傳送檔案</span>
  <span class="kt">bool</span> <span class="n">sendFile</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">file_name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">file_size</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 參數2指定binaryfile</span>
    <span class="n">ifstream</span> <span class="n">fin</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fin</span><span class="p">.</span><span class="n">is_open</span><span class="p">()</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"open file ("</span> <span class="o">&lt;&lt;</span> <span class="n">file_name</span> <span class="o">&lt;&lt;</span> <span class="s">") fail"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 每次要讀資料的個數(byte)</span>
    <span class="kt">int</span> <span class="n">read</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// 記錄已傳送資料的個數，若total_byte == file_size代表傳送完</span>
    <span class="kt">int</span> <span class="n">total_bytes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// 每次只傳送7byte</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 清空</span>
      <span class="n">memset</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
      <span class="c1">// 如果剩下的byte數量，大於7個，就傳送7個</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">file_size</span> <span class="o">-</span> <span class="n">total_bytes</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">read</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="c1">//小於7，就傳小於7的數量</span>
        <span class="n">read</span> <span class="o">=</span> <span class="n">file_size</span> <span class="o">-</span> <span class="n">total_bytes</span><span class="p">;</span>
      <span class="n">fin</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">read</span><span class="p">);</span>
      <span class="c1">// 把讀到的資料送給server</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">send</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">read</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
      <span class="c1">// 加上已傳送的數量</span>
      <span class="n">total_bytes</span> <span class="o">+=</span> <span class="n">read</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">total_bytes</span> <span class="o">==</span> <span class="n">file_size</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 第一個參數要修改buffer的內容，所以不加const</span>
  <span class="kt">bool</span> <span class="n">recv</span><span class="p">(</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">buffer</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">maxlen</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 清空string</span>
    <span class="n">buffer</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="c1">// 分配記憶體大小</span>
    <span class="n">buffer</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">maxlen</span><span class="p">);</span>
    <span class="c1">// 收到的資料放在buffer的記憶體空間</span>
    <span class="c1">// 操作到string的記憶體位址，有對string物件進行讀取與寫入</span>
    <span class="c1">// 第2個參數填不是const的記憶體位址，第3個參數填大小</span>
    <span class="c1">// &amp;buffer[0]取得位址，傳回值不是const</span>
    <span class="c1">// buffer.data()傳回值是const，所以不用</span>
    <span class="c1">// recv()傳回值是收到的資料大小</span>
    <span class="kt">int</span> <span class="n">iret</span> <span class="o">=</span> <span class="o">::</span><span class="n">recv</span><span class="p">(</span><span class="n">client_fd_</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">buffer</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
    <span class="c1">// iret = -1 失敗</span>
    <span class="c1">// iret = 0 socket斷線</span>
    <span class="c1">// iret &gt; 0 收到資料</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iret</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 失敗時把buffer清空，否則buffer大小一直維持1024</span>
      <span class="n">buffer</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 如果有操作到string的記憶體位址，string的自動擴展空間會失效</span>
    <span class="c1">// 需要自己重設string大小</span>
    <span class="c1">// 從1024大小，設為真正收到資料的大小</span>
    <span class="n">buffer</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">iret</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">bool</span> <span class="n">close</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// client_fd若已斷線，直接返回</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">client_fd_</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="o">::</span><span class="n">close</span><span class="p">(</span><span class="n">client_fd_</span><span class="p">);</span>
    <span class="n">client_fd_</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="o">~</span><span class="n">TCPClient</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">close</span><span class="p">();</span>
  <span class="p">}</span>
 <span class="nl">private:</span>
  <span class="kt">int</span> <span class="n">client_fd_</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">ip_</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port_</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"請輸入 ./client_test ip port 檔名 檔案大小"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 建立socket</span>
  <span class="n">TCPClient</span> <span class="n">tcp_client</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tcp_client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"socket"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 檔案結構</span>
  <span class="k">struct</span> <span class="nc">FileInfo</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">filename</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>  <span class="c1">// 檔名</span>
    <span class="kt">int</span> <span class="n">filesize</span><span class="p">;</span>  <span class="c1">// 檔案大小</span>
  <span class="p">}</span> <span class="n">file_info</span><span class="p">;</span>  <span class="c1">// 變數名</span>
  <span class="c1">// 清空</span>
  <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">file_info</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">file_info</span><span class="p">));</span>
  <span class="n">strcpy</span><span class="p">(</span><span class="n">file_info</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>  <span class="c1">// 檔名</span>
  <span class="n">file_info</span><span class="p">.</span><span class="n">filesize</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>  <span class="c1">// 檔案大小</span>
  <span class="c1">// 傳送結構(檔名與檔案大小)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tcp_client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="o">&amp;</span><span class="n">file_info</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">file_info</span><span class="p">))</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"send"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"傳送檔名 = "</span> <span class="o">&lt;&lt;</span> <span class="n">file_info</span><span class="p">.</span><span class="n">filename</span> <span class="o">&lt;&lt;</span>
  <span class="s">", 檔案大小 = "</span> <span class="o">&lt;&lt;</span> <span class="n">file_info</span><span class="p">.</span><span class="n">filesize</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// 收到server回應</span>
  <span class="n">string</span> <span class="n">buffer</span><span class="p">;</span>
  <span class="c1">// 參數2，"ok"是2byte</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tcp_client</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"recv"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">buffer</span> <span class="o">!=</span> <span class="s">"ok"</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"server沒回應ok"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 傳送檔案</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tcp_client</span><span class="p">.</span><span class="n">sendFile</span><span class="p">(</span><span class="n">file_info</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">file_info</span><span class="p">.</span><span class="n">filesize</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"sendFile"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 參數2，"ok"是2byte</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tcp_client</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"recv"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">buffer</span> <span class="o">!=</span> <span class="s">"ok"</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"傳送檔案失敗"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"client 傳送檔案成功"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="server程式碼">server程式碼</h3>

<figure class="highlight">
  <pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
</pre></td><td class="code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;netdb.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;arpa/inet.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp">
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">TCPServer</span> <span class="p">{</span>
 <span class="nl">public:</span>
  <span class="c1">// 建構子</span>
  <span class="c1">// 監聽listen_fd，-1代表未初始化</span>
  <span class="c1">// client_fd，-1代表未連線</span>
  <span class="n">TCPServer</span><span class="p">()</span> <span class="o">:</span> <span class="n">listen_fd_</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">client_fd_</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
  <span class="c1">// 初始化監聽的socket</span>
  <span class="kt">bool</span> <span class="n">initListen</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">listen_fd_</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="n">IPPROTO_TCP</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">listen_fd_</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">port_</span> <span class="o">=</span> <span class="n">port</span><span class="p">;</span>
    <span class="c1">// sockaddr_in結構</span>
    <span class="k">struct</span> <span class="nc">sockaddr_in</span> <span class="n">server_addr</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">server_addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">server_addr</span><span class="p">));</span>
    <span class="n">server_addr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
    <span class="c1">// server port</span>
    <span class="n">server_addr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">port_</span><span class="p">);</span>
    <span class="c1">// server有多個ip，所有ip都會監聽port</span>
    <span class="n">server_addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span>
    <span class="c1">// socket綁定ip與port</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">listen_fd_</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="nc">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">server_addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">server_addr</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 關閉監聽器</span>
      <span class="n">close</span><span class="p">(</span><span class="n">listen_fd_</span><span class="p">);</span>
      <span class="n">listen_fd_</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 把socket設為監聽的狀態</span>
    <span class="c1">// 最多只讓3個client同時連server</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">listen</span><span class="p">(</span><span class="n">listen_fd_</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">close</span><span class="p">(</span><span class="n">listen_fd_</span><span class="p">);</span>
      <span class="n">listen_fd_</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">bool</span> <span class="n">accept</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// client的ip結構</span>
    <span class="k">struct</span> <span class="nc">sockaddr_in</span> <span class="n">client_addr</span><span class="p">;</span>
    <span class="n">socklen_t</span> <span class="n">addr_len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">client_addr</span><span class="p">);</span>
    <span class="c1">// 接受client的連線</span>
    <span class="c1">// 若要得到client的ip，第二個參數填sockaddr_in結構，第3個參數填結構大小</span>
    <span class="c1">// 若不想得到client ip，第2與第3參數填0就好</span>
    <span class="n">client_fd_</span> <span class="o">=</span> <span class="o">::</span><span class="n">accept</span><span class="p">(</span><span class="n">listen_fd_</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="nc">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">client_addr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">addr_len</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">client_fd_</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="c1">// 取得client的ip</span>
    <span class="c1">// 透過inet_ntoa把big-endian轉成little-endian</span>
    <span class="n">client_ip_</span> <span class="o">=</span> <span class="n">inet_ntoa</span><span class="p">(</span><span class="n">client_addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">getClientIp</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">client_ip_</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">bool</span> <span class="n">send</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">buffer</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 如果client fd是-1就沒必要繼續後面的動作，直接返回</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">client_fd_</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="c1">// send()第2個參數填記憶體位址，第3個參數填大小</span>
    <span class="k">if</span> <span class="p">((</span><span class="o">::</span><span class="n">send</span><span class="p">(</span><span class="n">client_fd_</span><span class="p">,</span> <span class="n">buffer</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">buffer</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 第一個參數要修改buffer的內容，所以不加const</span>
  <span class="kt">bool</span> <span class="n">recv</span><span class="p">(</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">buffer</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">maxlen</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 清空string</span>
    <span class="n">buffer</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="c1">// 分配記憶體大小</span>
    <span class="n">buffer</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">maxlen</span><span class="p">);</span>
    <span class="c1">// 收到的資料放在buffer的記憶體空間</span>
    <span class="c1">// 操作到string的記憶體位址，有對string物件進行讀取與寫入</span>
    <span class="c1">// 第2個參數填不是const的記憶體位址，第3個參數填大小</span>
    <span class="c1">// &amp;buffer[0]取得位址，傳回值不是const</span>
    <span class="c1">// buffer.data()傳回值是const，所以不用</span>
    <span class="c1">// recv()傳回值是收到的資料大小</span>
    <span class="kt">int</span> <span class="n">iret</span> <span class="o">=</span> <span class="o">::</span><span class="n">recv</span><span class="p">(</span><span class="n">client_fd_</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">buffer</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
    <span class="c1">// iret = -1 失敗</span>
    <span class="c1">// iret = 0 socket斷線</span>
    <span class="c1">// iret &gt; 0 收到資料</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iret</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"iret = "</span> <span class="o">&lt;&lt;</span> <span class="n">iret</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="c1">// 失敗時把buffer清空，否則buffer大小一直維持1024</span>
      <span class="n">buffer</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 如果有操作到string的記憶體位址，string的自動擴展空間會失效</span>
    <span class="c1">// 需要自己重設string大小</span>
    <span class="c1">// 從1024大小，設為真正收到資料的大小</span>
    <span class="n">buffer</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">iret</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 收到client傳來的檔案結構</span>
  <span class="kt">bool</span> <span class="n">recv</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">buffer</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">::</span><span class="n">recv</span><span class="p">(</span><span class="n">client_fd_</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">bool</span> <span class="n">recvFile</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">file_name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">file_size</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ofstream</span> <span class="n">fout</span><span class="p">;</span>
    <span class="n">fout</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fout</span><span class="p">.</span><span class="n">is_open</span><span class="p">()</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"open file "</span> <span class="o">&lt;&lt;</span> <span class="n">file_name</span> <span class="o">&lt;&lt;</span> <span class="s">"fail"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">total_bytes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">read</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">file_size</span> <span class="o">-</span> <span class="n">total_bytes</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">read</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">read</span> <span class="o">=</span> <span class="n">file_size</span> <span class="o">-</span> <span class="n">total_bytes</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">recv</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">read</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
      <span class="n">fout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">read</span><span class="p">);</span>
      <span class="n">total_bytes</span> <span class="o">+=</span> <span class="n">read</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">total_bytes</span> <span class="o">==</span> <span class="n">file_size</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 關閉監聽socket</span>
  <span class="kt">bool</span> <span class="n">closeListen</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 若未初始化，直接返回</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">listen_fd_</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="o">::</span><span class="n">close</span><span class="p">(</span><span class="n">listen_fd_</span><span class="p">);</span>
    <span class="c1">// 設為未初始化-1</span>
    <span class="n">listen_fd_</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 關閉client socket</span>
  <span class="kt">bool</span> <span class="n">closeClient</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// client_fd若已斷線，直接返回</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">client_fd_</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="o">::</span><span class="n">close</span><span class="p">(</span><span class="n">client_fd_</span><span class="p">);</span>
    <span class="c1">// 設成未連線-1</span>
    <span class="n">client_fd_</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="o">~</span><span class="n">TCPServer</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 解構子把二個socket都關掉</span>
    <span class="n">closeListen</span><span class="p">();</span>
    <span class="n">closeClient</span><span class="p">();</span>
  <span class="p">}</span>
 <span class="nl">private:</span>
  <span class="kt">int</span> <span class="n">listen_fd_</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">client_fd_</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">client_ip_</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port_</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"請輸入 ./server_test port 存放目錄"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 建立監聽fd listen_fd</span>
  <span class="n">TCPServer</span> <span class="n">tcpServer</span><span class="p">;</span>
  <span class="c1">// 初始化監聽</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tcpServer</span><span class="p">.</span><span class="n">initListen</span><span class="p">(</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"initListen"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 接受client連接</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tcpServer</span><span class="p">.</span><span class="n">accept</span><span class="p">()</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"accept"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"client已連上 = "</span> <span class="o">&lt;&lt;</span> <span class="n">tcpServer</span><span class="p">.</span><span class="n">getClientIp</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// 檔案結構</span>
  <span class="k">struct</span> <span class="nc">FileInfo</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">filename</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>  <span class="c1">// 檔名</span>
    <span class="kt">int</span> <span class="n">filesize</span><span class="p">;</span>  <span class="c1">// 檔案大小</span>
  <span class="p">}</span> <span class="n">file_info</span><span class="p">;</span>  <span class="c1">// 變數名</span>
  <span class="c1">// 清空</span>
  <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">file_info</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">file_info</span><span class="p">));</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tcpServer</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="o">&amp;</span><span class="n">file_info</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">file_info</span><span class="p">))</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"recv()"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"server 收到檔名 = "</span> <span class="o">&lt;&lt;</span> <span class="n">file_info</span><span class="p">.</span><span class="n">filename</span> <span class="o">&lt;&lt;</span>
  <span class="s">", 檔案大小 = "</span> <span class="o">&lt;&lt;</span> <span class="n">file_info</span><span class="p">.</span><span class="n">filesize</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tcpServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"ok"</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"send"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tcpServer</span><span class="p">.</span><span class="n">recvFile</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">file_info</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">file_info</span><span class="p">.</span><span class="n">filesize</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"檔案傳送失敗"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"檔案傳送成功"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">tcpServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"ok"</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</figure>

<h3 id="測試方式">測試方式</h3>

<h4 id="server-1">server</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./server_test 1234 /tmp
client已連上 = 192.168.235.128
server 收到檔名 = test1.txt, 檔案大小 = 15890
檔案傳送成功
$ cd /tmp
$ ls
test1.txt
VMwareDnD
vmware-root_727-4290690966
$ ll test1.txt
-rw-rw-r-- 1 cici cici 15890  1月 17 13:03 test1.txt
</code></pre></div></div>

<h4 id="client-1">client</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ll test1.txt
-rw-rw-r-- 1 cici cici 15890 12月 31 13:33 test1.txt
$ ./client_test 192.168.235.128 1234 test1.txt 15890
傳送檔名 = test1.txt, 檔案大小 = 15890
client 傳送檔案成功
</code></pre></div></div>

</section>
            </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div></div>
    </div>
</div>

<!-- introduce mathjax support -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [ ['$', '$'], ['\\(', '\\)'] ]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script
  type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>


<!-- introduce per-page mermaid support -->


<!-- introduce mathjax support -->
<script>
    function fixes_chrome_anchors() {
        let chrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
        if (window.location.hash && chrome) {
            setTimeout(function () {
                var hash = window.location.hash;
                window.location.hash = "";
                window.location.hash = hash;
            }, 300);
        }
    }

    if (document.readyState === "loading") {
        // Loading hasn't finished yet
        document.addEventListener("DOMContentLoaded", fixes_chrome_anchors);
    } else {
        // `DOMContentLoaded` has already fired
        fixes_chrome_anchors();
    }
</script>

<!------上一頁與下一頁 start---------->
                    
                    
                    
                    
    
                    
                        
                        <a href="/pages/c/socket/fork_socket" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 多工的socket">
                            <i class="fa fa-angle-left"></i>
                        </a>
                    

                    
                        
                        <a href="/pages/ffmpeg/install_ffmpeg_mac" class="navigation navigation-next navigation-unique" aria-label="Next page: FFmpeg on Mac">
                            <i class="fa fa-angle-right"></i>
                        </a>
                    
                    <!------上一頁與下一頁 end---------->
                </div>
            </div>

            <script>
            var gitbook = gitbook || [];
            gitbook.push(function() {
                gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "next": {
            "title": "FFmpeg on Mac",
            "level": "1.2",
            "depth": 1,
            "path": "_pages/ffmpeg/install_ffmpeg_mac.md",
            "ref": "_pages/ffmpeg/install_ffmpeg_mac.md",
            "articles": []
        },
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "expandable-chapter-small2": {
                "articlesExpand": true,
            },
            "fontsettings": {
                "family": "sans",
                "size": 2,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},            "sharing": {
                "facebook": true,

                "google": false,

                "github": true,
              
                "github_link": "https://github.com",
              

                "telegram": false,
                "telegram_link": "https://t.me",

                "instapaper": false,

                "twitter": true,
              

                "vk": false,

                "weibo": false,

                "all": ["facebook", "google", "twitter", "weibo", "instapaper", "github", "telegram"]
            },
"theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            },
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "README.md",
        },
        "variables": {},
        "title": "Cici's notebook",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "_pages/c/socket/file_socket.md",
        "mtime": "2025-01-17 00:00:00 +0800",
        "type": "markdown"
    },
    "gitbook": {
        "version": "",
        "time": "2025-02-25 15:42:39 +0800"
    },
    "basePath": "",
    "book": {
        "language": ""
    }
});
            });
            </script>
        </div><script src="/assets/gitbook/gitbook.js"></script>
<script src="/assets/gitbook/theme.js"></script>

<script src="/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
<script src="/assets/gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
<script src="/assets/gitbook/gitbook-plugin-expandable-chapters-small2/expandable-chapters-small.js"></script>
<script src="/assets/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
<script src="/assets/gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
<script src="/assets/gitbook/gitbook-plugin-search-pro/search.js"></script>
<script src="/assets/gitbook/gitbook-plugin-sharing/buttons.js"></script>
<script src="/assets/gitbook/gitbook-plugin-splitter/splitter.js"></script>

<!--
<script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script>
-->

<script src="/assets/gitbook/custom.js"></script>
<script src="/assets/gitbook/custom-local.js"></script>

</body>
</html>